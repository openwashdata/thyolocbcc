library(washr)
setup_rawdata()
# Description ------------------------------------------------------------------
# R script to process uploaded raw data into a tidy, analysis-ready data frame
# Load packages ----------------------------------------------------------------
## Run the following code in console if you don't have the packages
## install.packages(c("usethis", "fs", "here", "readr", "readxl", "openxlsx"))
library(usethis)
library(fs)
library(here)
library(readr)
library(dplyr)
library(readxl)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(maps)
# Load Data --------------------------------------------------------------------
# Load the necessary data from a CSV file
data_in <- readr::read_csv("data-raw/Thyolo CBCC WASH Survey Data.csv")
# (Optional) Read and clean the codebook if needed (commented out for now)
# codebook <- readxl::read_excel("data-raw/codebook.xlsx") %>%
#   clean_names()
# Tidy data --------------------------------------------------------------------
# Remove rows where the 'latitude' column contains NULL (NA) values
data_in <- data_in %>%
filter(!is.na(latitude))
# Description ------------------------------------------------------------------
# R script to process uploaded raw data into a tidy, analysis-ready data frame
# Load packages ----------------------------------------------------------------
## Run the following code in console if you don't have the packages
## install.packages(c("usethis", "fs", "here", "readr", "readxl", "openxlsx"))
library(usethis)
library(fs)
library(here)
library(readr)
library(dplyr)
library(readxl)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(maps)
# Load Data --------------------------------------------------------------------
# Load the necessary data from a CSV file
data_in <- readr::read_csv("data-raw/Thyolo CBCC WASH Survey Data.csv")
# (Optional) Read and clean the codebook if needed (commented out for now)
# codebook <- readxl::read_excel("data-raw/codebook.xlsx") %>%
#   clean_names()
# Tidy data --------------------------------------------------------------------
# Remove rows where the 'latitude' column contains NULL (NA) values
data_in <- data_in %>%
filter(!is.na(latitude))
# Function to check for non-UTF-8 characters in character columns
check_utf8 <- function(df) {
# Identify columns with invalid UTF-8 characters
invalid_cols <- sapply(df, function(column) {
if (!is.character(column)) return(FALSE) # Skip non-character columns
any(sapply(column, function(x) {
if (is.na(x)) return(FALSE) # Ignore NA values
!identical(iconv(x, from = "UTF-8", to = "UTF-8"), x)
}))
})
# Extract the column names with invalid characters
bad_cols <- names(df)[invalid_cols]
# Output a message depending on whether non-UTF-8 characters were found
if (length(bad_cols) > 0) {
message("Non-UTF-8 characters detected in columns: ",
paste(bad_cols, collapse = ", "))
} else {
message("No non-UTF-8 characters found.")
}
}
# Convert character columns from Latin1 encoding to UTF-8, removing problematic
#   characters
data_in[] <- lapply(data_in, function(x) {
if (is.character(x)) {
# Convert to UTF-8 and remove problematic characters
iconv(x, from = "latin1", to = "UTF-8", sub = "")
} else {
x
}
})
# Re-check the data for non-UTF-8 characters after the conversion
check_utf8(data_in)
thyolocbcc <- data_in
# Export Data ------------------------------------------------------------------
usethis::use_data(thyolocbcc, overwrite = TRUE)
fs::dir_create(here::here("inst", "extdata"))
readr::write_csv(thyolocbcc,
here::here("inst", "extdata", paste0("thyolocbcc", ".csv")))
openxlsx::write.xlsx(thyolocbcc,
here::here("inst", "extdata", paste0("thyolocbcc",
".xlsx")))
setup_dictionary()
setup_roxygen()
devtools::document()
devtools::check()
devtools::install()
use_author(
given = "Emmanuel",
family = "Mhango",
role = c("aut", "cre"),
email = "emmanuellmhango@gmail.com",
comment = c(ORCID = "0000-0003-3197-6244")
)
use_author(given = "A", family = "Kandodo", role = "ctb")
use_author(given = "Tobby", family = "Milanzi", role = "ctb")
use_author(given = "Victor", family = "Daudi", role = "ctb")
use_author(given = "M", family = "Banda", role = "ctb")
use_author(given = "Benson", family = "Isake", role = "ctb")
use_author(given = "Brian", family = "Ntutha", role = "ctb")
use_author(given = "R", family = "Sawiche", role = "ctb")
use_author(given = "Justice", family = "Elliot", role = "ctb")
use_author(given = "M", family = "Nzengo", role = "ctb")
use_author(given = "Christian", family = "Nedi", role = "ctb")
use_author(given = "Khumbo", family = "Zinyongo", role = "ctb")
use_author(given = "M", family = "Kazembe", role = "ctb")
update_description()
devtools::document()
devtools::check()
devtools::install()
add_creator(name="Emmanuel Mhango", email="emmanuellmhango@gmail.com", affiliation="Openwashdata")
setup_readme()
# Description ------------------------------------------------------------------
# R script to process uploaded raw data into a tidy, analysis-ready data frame
# Load packages ----------------------------------------------------------------
## Run the following code in console if you don't have the packages
## install.packages(c("usethis", "fs", "here", "readr", "readxl", "openxlsx"))
library(usethis)
library(fs)
library(here)
library(readr)
library(dplyr)
library(readxl)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(maps)
# Load Data --------------------------------------------------------------------
# Load the necessary data from a CSV file
data_in <- readr::read_csv("data-raw/Thyolo CBCC WASH Survey Data.csv")
# (Optional) Read and clean the codebook if needed (commented out for now)
# codebook <- readxl::read_excel("data-raw/codebook.xlsx") %>%
#   clean_names()
# Tidy data --------------------------------------------------------------------
# Remove rows where the 'latitude' column contains NULL (NA) values
data_in <- data_in %>%
filter(!is.na(latitude))
# Function to check for non-UTF-8 characters in character columns
check_utf8 <- function(df) {
# Identify columns with invalid UTF-8 characters
invalid_cols <- sapply(df, function(column) {
if (!is.character(column)) return(FALSE) # Skip non-character columns
any(sapply(column, function(x) {
if (is.na(x)) return(FALSE) # Ignore NA values
!identical(iconv(x, from = "UTF-8", to = "UTF-8"), x)
}))
})
# Extract the column names with invalid characters
bad_cols <- names(df)[invalid_cols]
# Output a message depending on whether non-UTF-8 characters were found
if (length(bad_cols) > 0) {
message("Non-UTF-8 characters detected in columns: ",
paste(bad_cols, collapse = ", "))
} else {
message("No non-UTF-8 characters found.")
}
}
# Convert character columns from Latin1 encoding to UTF-8, removing problematic
#   characters
data_in[] <- lapply(data_in, function(x) {
if (is.character(x)) {
# Convert to UTF-8 and remove problematic characters
iconv(x, from = "latin1", to = "UTF-8", sub = "")
} else {
x
}
})
# Re-check the data for non-UTF-8 characters after the conversion
check_utf8(data_in)
thyolocbcc <- data_in
# Export Data ------------------------------------------------------------------
usethis::use_data(thyolocbcc, overwrite = TRUE)
fs::dir_create(here::here("inst", "extdata"))
readr::write_csv(thyolocbcc,
here::here("inst", "extdata", paste0("thyolocbcc", ".csv")))
openxlsx::write.xlsx(thyolocbcc,
here::here("inst", "extdata", paste0("thyolocbcc",
".xlsx")))
ggplot(thyolocbcc, aes(x = main_water_source)) +
geom_bar(fill = "#1f78b4") +
labs(title = "Main Water Source Types Across CBCCs",
x = "Water Source Type",
y = "Number of CBCCs") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
install.packages("forcats")
#library(ggplot2)
library(forcats)
ggplot(thyolocbcc, aes(x = main_water_source)) +
geom_bar(fill = "#1f78b4") +
labs(title = "Main Water Source Types Across CBCCs",
x = "Water Source Type",
y = "Number of CBCCs") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#library(ggplot2)
library(forcats)
ggplot(thyolocbcc, aes(x = fct_explicit_na(main_water_source, na_level = "Other"))) +
geom_bar(fill = "#1f78b4") +
labs(title = "Main Water Source Types Across CBCCs",
x = "Water Source Type",
y = "Number of CBCCs") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
year_round <- cbcc_data %>%
filter(!is.na(water_available_year_round)) %>%
count(water_available_year_round) %>%
mutate(percent = round(100 * n / sum(n), 1),
label = paste0(water_available_year_round, " (", percent, "%)"))
ggplot(year_round, aes(x = "", y = n, fill = water_available_year_round)) +
geom_col(width = 1, color = "white") +
coord_polar(theta = "y") +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5),
color = "white", size = 4) +
labs(title = "Year-Round Water Availability at CBCCs") +
theme_void() +
scale_fill_brewer(palette = "Set2")
year_round <- thyolocbcc %>%
filter(!is.na(water_available_year_round)) %>%
count(water_available_year_round) %>%
mutate(percent = round(100 * n / sum(n), 1),
label = paste0(water_available_year_round, " (", percent, "%)"))
ggplot(year_round, aes(x = "", y = n, fill = water_available_year_round)) +
geom_col(width = 1, color = "white") +
coord_polar(theta = "y") +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5),
color = "white", size = 4) +
labs(title = "Year-Round Water Availability at CBCCs") +
theme_void() +
scale_fill_brewer(palette = "Set2")
